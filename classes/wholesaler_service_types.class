<?php
///////////////////////////////////////////////////////////////////////////////
//
// wholesaler_service_types.class - Class for accessing wholesaler_service_types details
// $Id$
//
///////////////////////////////////////////////////////////////////////////////
//
// HISTORY:
// $Log$
///////////////////////////////////////////////////////////////////////////////
include_once "db.class";
include_once "config.class";
include_once "validate.class";
include_once "wholesalers.class";
include_once "service_types.class";
include_once "audit.class";

class wholesaler_service_types {
  
  var $wholesaler_id;
  var $type_id;

  var $db;
  var $server_name;
  var $database_name;
  var $user_name;
  var $user_password;


  /* function wholesaler_service_types() 
  **
  ** DESCRIPTION: Class constructor, initalizes and sets up DB connectoin
  **
  ** PARAMETERS:
  **
  ** RETURNS:
  ** 
  */
  function wholesaler_service_types() { 
    
  
    $config = new config();
    
    $this->server_name = $config->mysql_server_name;
    $this->database_name = $config->mysql_database_name;
    $this->user_name = $config->mysql_user_name;
    $this->user_password = $config->mysql_user_password;

    $this->db = new db($this->server_name, $this->database_name, $this->user_name, $this->user_password);
    
  }

  /* function load()
  **
  ** DESCRIPTION: loads data from table
  **
  ** PARAMETERS:
  ** - none
  **
  ** RETURNS:
  ** 1 - sucess
  ** 0 - fail
  ** 
  */
  function load() {

    $this->wholesaler_id = strtoupper($this->wholesaler_id);

    if (!$this->wholesaler_id) {
    
      return 0;
      
    }
  
    if ($this->wholesaler_id) {
      
      $query = "SELECT * FROM wholesaler_service_types WHERE wholesaler_id = " . $this->db->quote($this->wholesaler_id);
      $result = $this->db->execute_query($query);
      if ($result != 0 ) {

        $row = $this->db->fetch_row_array($result);
         if ( $row ) { 
          while ($cel = each($row)) {

            $key = $cel['key'];
            
            $this->{$key} = $cel['value'];
          }
        }
      }    
    }


    return 0;
    
  }

  /* function exist()
  **
  ** DESCRIPTION: checks to see if an id exists
  **
  ** PARAMETERS:
  ** - none
  **
  ** RETURNS:
  ** 1 - service_type exists
  ** 0 - service_type does not exist
  ** 
  */
  function exist() {
  
    $this->wholesaler_id = strtolower($this->wholesaler_id);
    $this->type_id = strtolower($this->type_id);
  
    // Check we have an user
    if (!$this->wholesaler_id) {
    
      return 0;
      
    }

    if (!$this->type_id) {
    
      return 0;
      
    }
    
    $query = "SELECT wholesaler_id FROM wholesaler_service_types WHERE wholesaler_id = " . $this->db->quote($this->wholesaler_id) . " AND type_id=" . $this->db->quote($this->type_id);
    $result = $this->db->execute_query($query);
      
    if ($result != 0 ) {
    
      $row_count = $this->db->fetch_row_count($result);
      
      if ($row_count == 1) {
      
        return 1;
        
      } else {
      
        return 0;
        
      }
      
    }
    
    return 0;
  
    
  }



  /* function create()
  **
  ** DESCRIPTION: creates a new entry
  **
  ** PARAMETERS:
  ** - none
  **
  ** RETURNS:
  ** 1 - sucess
  ** 0 - fail
  ** 
  */
  function create_real() {
  
    // Validate
    if (wholesaler_service_types::validate()) {
    
      return 0;
      
    }

    // Create the wholesaler_service_types
    $query = "INSERT INTO wholesaler_service_types (wholesaler_id, type_id)";
    $query .= " VALUES (" . $this->db->quote($this->wholesaler_id) . "," . $this->db->quote($this->type_id) . ")";

    $result = $this->db->execute_query($query);
    
    if ($result == 0) {
      return 0;
      
    } else {

        $this->load();

        $audit = new audit();
        $audit->order_id = $this->wholesaler_id;
        $audit->param = $this->param;
        $audit->value = $this->value;
        $audit->store_first_changes_attributes("wholesaler_service_types");

      return 1;
          
    }
  }
  
  function create() {
    if ($this->create_real() == 1) {

      $this->load();
    
      return 1;
      
    } else {
    
      return 0;
      
    }    
      
  }


  /* function delete()
  **
  ** DESCRIPTION: Deletes an entry
  **
  ** PARAMETERS:
  ** - none
  **
  ** RETURNS:
  ** 1 - sucess
  ** 0 - fail
  ** 
  */
  function delete() {
    
    if (!$this->exist()) {
    
      return 0;
      
    }
    
    // Prepare the query
    $query = "DELETE FROM wholesaler_service_types WHERE wholesaler_id = " . $this->db->quote($this->wholesaler_id) . " AND type_id = " . $this->db->quote($this->type_id);
    $result = $this->db->execute_query($query);
    
    if ($result == 0) {
    
      return 0;
      
    } else {

    return 1;
    }
  }

  /* function validate()
  **
  ** DESCRIPTION: validates data currently stored in variables
  **
  ** PARAMETERS:
  ** - none
  **
  ** RETURNS:
  ** 0 - sucess
  ** 
  */
  function validate() {
    
    if ( !$this->wholesaler_id ) {

      return 100;

    } else {

      $wholesaler = new wholesalers();
      $wholesaler->wholesaler_id = $this->wholesaler_id;
      $wholesaler->exist();

      if ( !$wholesaler ) {

        return 100;

      }

    }

    if ( !$this->type_id ) {

      return 140;

    } else {

      $service_type = new service_types();
      $service_type->type_id = $this->type_id;
      $service_type->exist();

      if ( !$service_type ) {

        return 140;

      }

    }
    
    // ALL OK
    return 0;
    
  }

   /* function get_wholesaler_services()
  **
  ** DESCRIPTION: loads data from table
  **
  ** PARAMETERS:
  ** - none
  **
  ** RETURNS:
  ** - array of wholesaler_services with correpsonding details
  ** 
  */

  function get_wholesaler_services(){
      $a = array();
      if ( !$this->wholesaler_id ) {
        return 0;
      }

      $query = "SELECT * FROM wholesaler_service_types WHERE wholesaler_id=" . $this->wholesaler_id;
      $result = $this->db->execute_query($query);
      
      if ($result != 0 ) {

        while($row = $this->db->fetch_row_array($result)) {
          $a[] = $row;
        }
      }

    return $a;

  }

}

